{"version":3,"sources":["../src/kalvidassign.js"],"names":["SELECTORS","OPEN_VIDEO_PICKER","OPEN_UPLOAD_MODAL","ENTRY_ID","ENTRY_THUMBNAIL","SELECTED_ENTRY_HEADER","SUBMIT","init","contextid","entryid","entryname","entrythumbnail","hasCe","Promise","all","ModalFactory","create","type","ModalVideoPicker","getType","ModalKalturaUpload","modal","uploadModal","selectedEntryId","selectedEntryName","selectedEntryThumbnail","registerEventListeners","Notification","exception","on","show","e","preventDefault","uploadFormType","currentTarget","attr","renderUploadForm","ModalVideoPickerEvents","entrySelected","data","updateSubmission","entryId","entryName","entryThumbnail","KalturaEvents","uploadComplete","hide","KalturaAjax","getEntry","entry","id","name","thumbnailUrl","selectedEntryText","val","text","prop"],"mappings":"yZAAA,OAEA,OAIA,OACA,OACA,OACA,OAEA,OACA,O,8xBAEMA,CAAAA,CAAS,CAAG,CACdC,iBAAiB,CAAE,6BADL,CAEdC,iBAAiB,CAAE,0BAFL,CAGdC,QAAQ,CAAE,WAHI,CAIdC,eAAe,CAAE,kBAJH,CAKdC,qBAAqB,CAAE,yCALT,CAMdC,MAAM,CAAE,eANM,C,CASLC,CAAI,4CAAG,WAAOC,CAAP,CAAkBC,CAAlB,CAA2BC,CAA3B,CAAsCC,CAAtC,CAAsDC,CAAtD,uHAEuBC,CAAAA,OAAO,CAACC,GAAR,CAAY,CAC3CC,UAAaC,MAAb,CAAoB,CAACC,IAAI,CAAEC,UAAiBC,OAAjB,EAAP,CAApB,CAD2C,CAE3CJ,UAAaC,MAAb,CAAoB,CAACC,IAAI,CAAEG,UAAmBD,OAAnB,EAAP,CAApB,CAF2C,CAAZ,CAFvB,0BAELE,CAFK,MAEEC,CAFF,MAOZD,CAAK,CAACb,SAAN,CAAkBA,CAAlB,CACAa,CAAK,CAACE,eAAN,CAAwBd,CAAxB,CACAY,CAAK,CAACG,iBAAN,CAA0Bd,CAA1B,CACAW,CAAK,CAACI,sBAAN,CAA+Bd,CAA/B,CACAU,CAAK,CAACT,KAAN,CAAcA,CAAd,CAEAU,CAAW,CAACd,SAAZ,CAAwBA,CAAxB,CAEAkB,CAAsB,CAACL,CAAD,CAAQC,CAAR,CAAqBd,CAArB,CAAtB,CAfY,qDAiBZmB,UAAaC,SAAb,OAjBY,uDAAH,uD,aAqBXF,CAAAA,CAAsB,CAAG,SAACL,CAAD,CAAQC,CAAR,CAAqBd,CAArB,CAAmC,CAE9D,cAAER,CAAS,CAACC,iBAAZ,EAA+B4B,EAA/B,CAAkC,OAAlC,CAA2C,UAAM,CAC7CR,CAAK,CAACS,IAAN,EACH,CAFD,EAIA,cAAE9B,CAAS,CAACE,iBAAZ,EAA+B2B,EAA/B,CAAkC,OAAlC,CAA2C,SAACE,CAAD,CAAO,CAC9CA,CAAC,CAACC,cAAF,GACA,GAAMC,CAAAA,CAAc,CAAG,cAAEF,CAAC,CAACG,aAAJ,EAAmBC,IAAnB,CAAwB,kBAAxB,CAAvB,CACAb,CAAW,CAACc,gBAAZ,CAA6BH,CAA7B,EACAX,CAAW,CAACQ,IAAZ,EACH,CALD,EAOA,gBAAUO,UAAuBC,aAAjC,4CAAgD,WAAOC,CAAP,mFAC5CC,CAAgB,CAACD,CAAI,CAACE,OAAN,CAAeF,CAAI,CAACG,SAApB,CAA+BH,CAAI,CAACI,cAApC,CAAhB,CAD4C,wCAAhD,yDAIA,gBAAUC,UAAcC,cAAxB,4CAAwC,WAAOpC,CAAP,yFACpCa,CAAW,CAACwB,IAAZ,GADoC,eAEhBC,WAAYC,QAAZ,CAAqBxC,CAArB,CAAgCC,CAAhC,CAFgB,QAE9BwC,CAF8B,QAGpCT,CAAgB,CAACS,CAAK,CAACC,EAAP,CAAWD,CAAK,CAACE,IAAjB,CAAuBF,CAAK,CAACG,YAA7B,CAAhB,CAEA/B,CAAK,CAACE,eAAN,CAAwB0B,CAAK,CAACC,EAA9B,CACA7B,CAAK,CAACG,iBAAN,CAA0ByB,CAAK,CAACE,IAAhC,CACA9B,CAAK,CAACI,sBAAN,CAA+BwB,CAAK,CAACG,YAArC,CAPoC,wCAAxC,wDAUH,C,CAEKZ,CAAgB,4CAAG,WAAO/B,CAAP,CAAgB0C,CAAhB,CAAsBC,CAAtB,wGACW,iBAAU,gBAAV,CAA4B,eAA5B,CAA6CD,CAA7C,CADX,QACfE,CADe,QAErB,cAAErD,CAAS,CAACG,QAAZ,EAAsBmD,GAAtB,CAA0B7C,CAA1B,EACA,cAAET,CAAS,CAACI,eAAZ,EAA6B+B,IAA7B,CAAkC,KAAlC,CAAyCiB,CAAzC,EACA,cAAEpD,CAAS,CAACK,qBAAZ,EAAmCkD,IAAnC,CAAwCF,CAAxC,EACA,cAAErD,CAAS,CAACM,MAAZ,EAAoBkD,IAApB,CAAyB,UAAzB,KALqB,wCAAH,uD","sourcesContent":["import $ from 'jquery';\n\nimport Notification from 'core/notification';\nimport {subscribe} from 'core/pubsub';\nimport {get_string as getString} from 'core/str';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalVideoPicker from 'local_kaltura/modal_video_picker';\nimport ModalVideoPickerEvents from 'local_kaltura/modal_video_picker_events';\nimport ModalKalturaUpload from 'local_kaltura/modal_kaltura_upload';\n\nimport KalturaEvents from 'local_kaltura/kaltura_events';\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\n\nconst SELECTORS = {\n    OPEN_VIDEO_PICKER: '[data-action=\"add-media\"]',\n    OPEN_UPLOAD_MODAL: '[data-action=\"upload\"]',\n    ENTRY_ID: '#entry_id',\n    ENTRY_THUMBNAIL: '#media_thumbnail',\n    SELECTED_ENTRY_HEADER: '[data-region=\"selected-entry-header\"]',\n    SUBMIT: '#submit_media'\n};\n\nexport const init = async (contextid, entryid, entryname, entrythumbnail, hasCe) => {\n    try {\n        const [modal, uploadModal] = await Promise.all([\n            ModalFactory.create({type: ModalVideoPicker.getType()}),\n            ModalFactory.create({type: ModalKalturaUpload.getType()})\n        ]);\n\n        modal.contextid = contextid;\n        modal.selectedEntryId = entryid;\n        modal.selectedEntryName = entryname;\n        modal.selectedEntryThumbnail = entrythumbnail;\n        modal.hasCe = hasCe;\n\n        uploadModal.contextid = contextid;\n\n        registerEventListeners(modal, uploadModal, contextid);\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n\nconst registerEventListeners = (modal, uploadModal, contextid) => {\n\n    $(SELECTORS.OPEN_VIDEO_PICKER).on('click', () => {\n        modal.show();\n    });\n\n    $(SELECTORS.OPEN_UPLOAD_MODAL).on('click', (e) => {\n        e.preventDefault();\n        const uploadFormType = $(e.currentTarget).attr('data-upload-type');\n        uploadModal.renderUploadForm(uploadFormType);\n        uploadModal.show();\n    });\n\n    subscribe(ModalVideoPickerEvents.entrySelected, async (data) => {\n        updateSubmission(data.entryId, data.entryName, data.entryThumbnail);\n    });\n\n    subscribe(KalturaEvents.uploadComplete, async (entryid) => {\n        uploadModal.hide();\n        const entry = await KalturaAjax.getEntry(contextid, entryid);\n        updateSubmission(entry.id, entry.name, entry.thumbnailUrl);\n\n        modal.selectedEntryId = entry.id;\n        modal.selectedEntryName = entry.name;\n        modal.selectedEntryThumbnail = entry.thumbnailUrl;\n    });\n\n};\n\nconst updateSubmission = async (entryid, name, thumbnailUrl) => {\n    const selectedEntryText = await getString('selected_entry', 'local_kaltura', name);\n    $(SELECTORS.ENTRY_ID).val(entryid);\n    $(SELECTORS.ENTRY_THUMBNAIL).attr('src', thumbnailUrl);\n    $(SELECTORS.SELECTED_ENTRY_HEADER).text(selectedEntryText);\n    $(SELECTORS.SUBMIT).prop('disabled', false);\n};"],"file":"kalvidassign.min.js"}
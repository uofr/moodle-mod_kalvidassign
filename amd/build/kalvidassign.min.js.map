{"version":3,"sources":["../src/kalvidassign.js"],"names":["SELECTORS","OPEN_VIDEO_PICKER","OPEN_UPLOAD_MODAL","ENTRY_ID","ENTRY_THUMBNAIL","SELECTED_ENTRY_HEADER","SUBMIT","init","contextid","entryid","entryname","entrythumbnail","Promise","all","ModalFactory","create","type","ModalVideoPicker","getType","ModalKalturaUpload","modal","uploadModal","selectedEntryId","selectedEntryName","selectedEntryThumbnail","registerEventListeners","Notification","exception","on","show","e","preventDefault","uploadFormType","currentTarget","attr","renderUploadForm","ModalVideoPickerEvents","entrySelected","entry","val","entryId","entryThumbnail","entryName","selectedEntryText","text","prop","KalturaEvents","uploadComplete","hide","KalturaAjax","getEntry","id","thumbnailUrl","name"],"mappings":"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","sourcesContent":["import $ from 'jquery';\n\nimport Notification from 'core/notification';\nimport {subscribe} from 'core/pubsub';\nimport {get_string as getString} from 'core/str';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalVideoPicker from 'local_kaltura/modal_video_picker';\nimport ModalVideoPickerEvents from 'local_kaltura/modal_video_picker_events';\nimport ModalKalturaUpload from 'local_kaltura/modal_kaltura_upload';\n\nimport KalturaEvents from 'local_kaltura/kaltura_events';\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\n\nconst SELECTORS = {\n    OPEN_VIDEO_PICKER: '[data-action=\"add-media\"]',\n    OPEN_UPLOAD_MODAL: '[data-action=\"upload\"]',\n    ENTRY_ID: '#entry_id',\n    ENTRY_THUMBNAIL: '#media_thumbnail',\n    SELECTED_ENTRY_HEADER: '[data-region=\"selected-entry-header\"]',\n    SUBMIT: '#submit_media'\n};\n\nexport const init = async (contextid, entryid, entryname, entrythumbnail) => {\n    try {\n        const [modal, uploadModal] = await Promise.all([\n            ModalFactory.create({type: ModalVideoPicker.getType()}),\n            ModalFactory.create({type: ModalKalturaUpload.getType()})\n        ]);\n\n        modal.contextid = contextid;\n        modal.selectedEntryId = entryid;\n        modal.selectedEntryName = entryname;\n        modal.selectedEntryThumbnail = entrythumbnail;\n\n        uploadModal.contextid = contextid;\n\n        registerEventListeners(modal, uploadModal, contextid);\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n\nconst registerEventListeners = (modal, uploadModal, contextid) => {\n\n    $(SELECTORS.OPEN_VIDEO_PICKER).on('click', () => {\n        modal.show();\n    });\n\n    $(SELECTORS.OPEN_UPLOAD_MODAL).on('click', (e) => {\n        e.preventDefault();\n        const uploadFormType = $(e.currentTarget).attr('data-upload-type');\n        uploadModal.renderUploadForm(uploadFormType);\n        uploadModal.show();\n    });\n\n    subscribe(ModalVideoPickerEvents.entrySelected, async (entry) => {\n        $(SELECTORS.ENTRY_ID).val(entry.entryId);\n        $(SELECTORS.ENTRY_THUMBNAIL).attr('src', entry.entryThumbnail);\n        const selectedEntryText = await getString('selected_entry', 'local_kaltura', entry.entryName);\n        $(SELECTORS.SELECTED_ENTRY_HEADER).text(selectedEntryText);\n        $(SELECTORS.SUBMIT).prop('disabled', false);\n    });\n\n    subscribe(KalturaEvents.uploadComplete, async (entryid) => {\n        uploadModal.hide();\n        const entry = await KalturaAjax.getEntry(contextid, entryid);\n        $(SELECTORS.ENTRY_ID).val(entry.id);\n        $(SELECTORS.ENTRY_THUMBNAIL).attr('src', entry.thumbnailUrl);\n        const selectedEntryText = await getString('selected_entry', 'local_kaltura', entry.name);\n        $(SELECTORS.SELECTED_ENTRY_HEADER).text(selectedEntryText);\n        $(SELECTORS.SUBMIT).prop('disabled', false);\n        modal.selectedEntryId = entry.id;\n        modal.selectedEntryName = entry.name;\n        modal.selectedEntryThumbnail = entry.thumbnailUrl;\n    });\n\n};"],"file":"kalvidassign.min.js"}